{% extends "weconnect/base.html" %}
{% block css %}
    <link rel="stylesheet" href="/static/bower_components/jquery-ui/themes/smoothness/jquery-ui.min.css">
{% endblock %}
{% block js %}
	<script src="/static/bower_components/jquery-ui/jquery-ui.min.js"></script>
{% endblock %}
{% load staticfiles %}
{% load sinceyear %}
{% load hformrow %}
{% block content %}
{% with "users_profile_business" as css_prefix %}

<h3 class="profile_header">Complete your portfolio to increase your chance of attracting new customers</h3>

<div class="{{ css_prefix }}_left col-md-8">
	<div class="{{ css_prefix }}_head">
		<div id="head-display">

			<a href="javascript:void(0)" class="{{ css_prefix }}_edit_btn blue-link" id="head" ><img alt="Edit" src="/static/image/edit.png"> Edit</a>

			<div class="{{ css_prefix }}_head_logo  col-md-3">
				{% if userprofile.logo %}
					<img class="{{ css_prefix }}s_head_logo_img" src="{% static userprofile.logo %}" alt="{{ userprofile.business_name }}">
				{% else %}
					<a href="javascript:void(0)" class="{{ css_prefix }}s_head_logo blue-link" id="add-your-logo">Add your logo</a>
				{% endif %}
			</div>

			<div class="{{ css_prefix }}_head_detail  col-md-9">
				<h3 class="profile_head_company_name">
					{{ userprofile.business_name }}
				</h3>			
				<div class="{{ css_prefix }}_head_company_contact">
					<div class="{{ css_prefix }}_head_contact_item col-md-6">
						<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/phone.png" alt="phone"></div>
						<div class="{{ css_prefix }}_head_contact_value">{{ userprofile.mobile_number }}</div>
					</div>
					<div class="{{ css_prefix }}_head_contact_item col-md-6">
						<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/employees.png" alt="employees"></div>
						<div class="{{ css_prefix }}_head_contact_value">{{ userprofile.employees }} Employee{{ userprofile.employees|pluralize }}</div>
					</div>
					<div class="{{ css_prefix }}_head_contact_item col-md-6">
						<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/website.png" alt="website"></div>
						<div class="{{ css_prefix }}_head_contact_value">{{ userprofile.website }}</div>
					</div>
					{% if userprofile.business_since %}
					<div class="{{ css_prefix }}_head_contact_item col-md-6">
						<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/since.png" alt="since"></div>
						<div class="{{ css_prefix }}_head_contact_value">Since {{ userprofile.business_since }}</div>
					</div>
					{% endif %}
					<div class="{{ css_prefix }}_head_contact_item col-md-6">
						<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/location.png" alt="location"></div>
						<div class="{{ css_prefix }}_head_contact_value">{{ userprofile.address_area }}</div>
					</div>
					<div class="clearfix"></div>
				</div>
				<div class="{{ css_prefix }}_head_person_contact">
					{% if userprofile.photo %}
						<div class="pitches_pitch_item_image col-md-4" style="background-image: url('{% static userprofile.photo %}')"></div>
					{% else %}
						<div class="pitches_pitch_item_image col-md-4" style="background-image: url('/static/image/no-image.png')"></div>
					{% endif %}

					<div class="col-md-8">
						<div class="{{ css_prefix }}_head_contact_item">
							<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/contact-name.png" alt="contact"></div>
							<div class="{{ css_prefix }}_head_contact_value">{{ user.full_name }}</div>
						</div>

						<div class="{{ css_prefix }}_head_contact_item">
							<div class="{{ css_prefix }}_head_contact_key"><img src="/static/image/email.png" alt="email"></div>
							<div class="{{ css_prefix }}_head_contact_value">{{ user.email }}</div>
						</div>
					</div>

				</div>
			</div>
		</div>
		<div id="head-form" class="hide">
			<form action="{% url 'users:profile' %}" method="post" enctype="multipart/form-data" class="form-horizontal">
				{% csrf_token %}
				{{ form_business_head.non_field_errors }}
				{{ form_business_head.business_name|hformrow:'Business Name'}}
				{{ form_business_head.logo|hformrow:'Company Logo'}}
				{{ form_credential.first_name|hformrow:'Your name' }}
				{{ form_business_head.photo|hformrow:'Your photo'}}
				{{ form_business_head.website|hformrow:'Website'}}
				{{ form_business_head.mobile_number|hformrow:'Mobile number'}}
				{{ form_business_head.employees|hformrow:'No. of employees' }}
				{{ form_business_head.business_since|hformrow:'Business started' }}
				{{ form_business_head.address_1|hformrow:'Room/Floor/Block' }}
				{{ form_business_head.address_2|hformrow:'Street/Residential address' }}
				{{ form_business_head.address_3|hformrow:'' }}
				{{ form_business_head.address_area|hformrow:'Area' }}
				<input type="hidden" value="head" name="part">
				<input id="head-cancel" type="button" value="Cancel" class="cancel_button btn btn-default pull-right"> 
				<input type="submit" value="Save" class="btn btn-primary pull-right">
			</form>
		</div>
		<div style="clear:both"></div>
	</div>


	<div class="{{ css_prefix }}_desc">
		<a href="javascript:void(0)" class="{{ css_prefix }}_edit_btn blue-link" id="company-desc"><img alt="Edit" src="/static/image/edit.png"> Edit</a>
		<h3 class="company-profile-head">About the company</h3>
		<div id="company-desc-display">
			{% if userprofile.desc %}
			<p>{{ userprofile.desc|linebreaksbr }}</p>
			{% else %}
			<p><i>Tell us more about your company. This will be essential for gaining new customers.</i></p>
			{% endif %}
		</div>
		<div id="company-desc-form" class="hide">
			<form action="{% url 'users:profile' %}" method="post" class="form-horizontal">
				{% csrf_token %}
				{{ form_business_company_desc.non_field_errors }}
				{{ form_business_company_desc.desc|hformrow:'About the company' }}
				<input type="hidden" value="company_desc" name="part">
				<input id="company-desc-cancel" type="button" value="Cancel" class="cancel_button btn btn-default pull-right"> 
				<input type="submit" value="Save" class="btn btn-primary pull-right">
			</form>
		</div>
		<div style="clear:both"></div>

	</div>

	<div class="{{ css_prefix }}_desc">
		<a href="javascript:void(0)" class="{{ css_prefix }}_edit_btn blue-link" id="service-desc"><img alt="Edit" src="/static/image/edit.png"> Edit</a>
		<h3 class="company-profile-head">Services</h3>
		<div id="service-desc-display">
			<div class="{{ css_prefix }}_service_item">
				<span class="{{ css_prefix }}_service_item_key_inline">Business Nature</span>
				<span class="{{ css_prefix }}_service_item_value_inline">{{ userprofile.business.first }}</span>
			</div>
			<div class="{{ css_prefix }}_service_item">
				<span class="{{ css_prefix }}_service_item_key_inline">Areas of expertise</span>
				<span class="{{ css_prefix }}_service_item_value_inline">{{ userprofile.sub_business.all|join:"<br>" }}</span>
			</div>
			<div class="{{ css_prefix }}_service_item">
				<span class="{{ css_prefix }}_service_item_key">Tell us more about your services</span>
				<span class="{{ css_prefix }}_service_item_value">{{ userprofile.service_desc|linebreaksbr }}</span>
			</div>
		</div>
		<div id="service-desc-form" class="hide">
			<form action="{% url 'users:profile' %}" method="post" class="form-horizontal">
				{% csrf_token %}
				{{ form_business_service_desc.non_field_errors }}
				<div class="form-group ">
					<label class="col-sm-3 control-label">Business</label>
					<div class="col-sm-9">
						<div class="form-control-static">{{ userprofile.business.first }}</div>			
					</div>
				</div>
				{{ form_business_service_desc.sub_business|hformrow:'Areas of expertise' }}
				{{ form_business_service_desc.service_desc|hformrow:'Tell us more about your services' }}
				<input type="hidden" value="service_desc" name="part">
				<input id="service-desc-cancel" type="button" value="Cancel" class="cancel_button btn btn-default pull-right"> 
				<input type="submit" value="Save" class="btn btn-primary pull-right">
			</form>
		</div>
		<div style="clear:both"></div>
	</div>

	<div class="{{ css_prefix }}_desc">
		<a href="javascript:void(0)" class="{{ css_prefix }}_edit_btn blue-link" id="preference" ><img alt="Edit" src="/static/image/edit.png"> Edit</a>
		<h3 class="company-profile-head">Preferences</h3>
		<div id="preference-display">
			<div class="{{ css_prefix }}_service_item">
				<span class="{{ css_prefix }}_service_item_key">I can travel to my customers</span>
				<span class="{{ css_prefix }}_service_item_value">{{ userprofile.travel_to_customer_text }}</span>
			</div>
			{% if userprofile.travel_to_customer != 'anywhere' %}
			<div class="{{ css_prefix }}_service_item">
				<span class="{{ css_prefix }}_service_item_key">Travel distance</span>
				<span class="{{ css_prefix }}_service_item_value">{{ userprofile.travel_distance.all|join:"<br>" }}</span>
			</div>
			{% endif %}
			<div class="{{ css_prefix }}_service_item">
				<span class="{{ css_prefix }}_service_item_key">Customer usually travel to me</span>
				<span class="{{ css_prefix }}_service_item_value">{{ userprofile.customer_travel|yesno }}</span>
			</div>

		</div>
		<div id="preference-form" class="hide">
			<form action="{% url 'users:profile' %}" method="post" class="form-horizontal">
				{% csrf_token %}
				{{ form_business_preference.travel_to_customer|hformrow:'I can travel to my customers' }}
				{{ form_business_preference.travel_distance|hformrow:'Travel distance' }}

				<input type="hidden" value="preference" name="part">
				<input id="preference-cancel" type="button" value="Cancel" class="cancel_button btn btn-default pull-right"> 
				<input type="submit" value="Save" class="btn btn-primary pull-right">
			</form>
		</div>
		<div style="clear:both"></div>
	</div>
</div>
<div class="{{ css_prefix }}_right col-md-4">
	<div class="{{ css_prefix }}_companysocial">
		<a href="javascript:void(0)" class="pull-right {{ css_prefix }}_edit_btn blue-link" id="company-social" ><img alt="Edit" src="/static/image/edit.png"> Edit</a>
		<h3  class="company-profile-right-head">Social Media</h3>
		<div id="company-social-display">
			{% if userprofile.facebook %}
			<a class="sm sm_facebook" href="{{ userprofile.facebook }}" target="_blank"></a>
			{% endif %}

			{% if userprofile.linkedin %}
			<a class="sm sm_linkedin" href="{{ userprofile.linkedin }}" target="_blank"></a>
			{% endif %}
			
			{% if userprofile.twitter %}
			<a class="sm sm_twitter" href="{{ userprofile.twitter }}" target="_blank"></a>
			{% endif %}

			{% if userprofile.google %}
			<a class="sm sm_google" href="{{ userprofile.google }}" target="_blank"></a>
			{% endif %}

			{% if userprofile.pinterest %}
			<a class="sm sm_pinterest" href="{{ userprofile.pinterest }}" target="_blank"></a>
			{% endif %}

			{% if userprofile.instagram %}
			<a class="sm sm_instagram" href="{{ userprofile.instagram }}" target="_blank"></a>
			{% endif %}
			<div class="clearfix"></div>
			<a href="javascript:void(0)" id="company-social-add">+ Add links to your social media</a>
		</div>
		<div id="company-social-form" class="hide">
			<form action="{% url 'users:profile' %}" method="post" class="form-horizontal">
				{% csrf_token %}
				{{ form_business_company_social.facebook|hformrow:'<div class="sm sm_facebook"></div>' }}
				{{ form_business_company_social.linkedin|hformrow:'<div class="sm sm_linkedin"></div>' }}
				{{ form_business_company_social.twitter|hformrow:'<div class="sm sm_twitter"></div>' }}
				{{ form_business_company_social.google|hformrow:'<div class="sm sm_google"></div>' }}
				{{ form_business_company_social.pinterest|hformrow:'<div class="sm sm_pinterest"></div>' }}
				{{ form_business_company_social.instagram|hformrow:'<div class="sm sm_instagram"></div>' }}

				<input type="hidden" value="company_social" name="part">
				<input id="company-social-cancel" type="button" value="Cancel" class="cancel_button btn btn-default pull-right"> 
				<input type="submit" value="Save" class="btn btn-primary pull-right">
			</form>
		</div>


		<div class="clearfix"></div>
	</div>

	<div class="{{ css_prefix }}_work">
		<a href="javascript:void(0)" class="pull-right {{ css_prefix }}_edit_btn blue-link" id="work" ><img alt="Edit" src="/static/image/edit.png"> Edit</a>
		<h3 class="company-profile-right-head">Work</h3>
		<div id="work-display">
			{% if userprofile.work_image_1 %}
			<img class="{{ css_prefix }}_work_image" src="{% static userprofile.work_image_1 %}">
			{% endif %}
			
			{% if userprofile.work_image_2 %}
			<img  class="{{ css_prefix }}_work_image" src="{% static userprofile.work_image_2 %}">
			{% endif %}

			{% if userprofile.work_image_3 %}
			<img class="{{ css_prefix }}_work_image" src="{% static userprofile.work_image_3 %}">
			{% endif %}
			<div class="clearfix"></div>
			<a href="javascript:void(0)" id="work-add">+ Add your photos, brochures or videos here</a>
		
		</div>
		<div id="work-form" class="hide">
			<form action="{% url 'users:profile' %}" method="post" enctype="multipart/form-data" class="form-horizontal">
				{% csrf_token %}
				{{ form_business_work.work_image_1|hformrow:'Image'}}
				{{ form_business_work.work_image_2|hformrow:'Image'}}
				{{ form_business_work.work_image_3|hformrow:'Image'}}
				<input type="hidden" value="work" name="part">
				<input id="work-cancel" type="button" value="Cancel" class="cancel_button btn btn-default pull-right">
				<input type="submit" value="Save" class="btn btn-primary pull-right">
			</form>
		</div>
	</div>
</div>

<!--
<form action="{% url 'users:profile' %}" method="post" enctype="multipart/form-data">
	{% csrf_token %}
	<ul>
		{{ form.as_ul }}
		<li>
			<input type="submit" value="Save">
		</li>
	</ul>
</form>
-->

<script>
	var edit = {
		'add-your-logo':{
			btn: $('#add-your-logo'),
			display: $('#head-display'),
			form: $('#head-form')		
		},
		'head' : {
			btn: $('#head'),
			cancelBtn: $('#head-cancel'),
			display: $('#head-display'),
			form: $('#head-form')
		},
		'company-desc' : {
			btn: $('#company-desc'),
			cancelBtn: $('#company-desc-cancel'),
			display: $('#company-desc-display'),
			form: $('#company-desc-form')
		},
		'service-desc' : {
			btn: $('#service-desc'),
			cancelBtn: $('#service-desc-cancel'),
			display: $('#service-desc-display'),
			form: $('#service-desc-form')
		},
		'preference' : {
			btn: $('#preference'),
			cancelBtn: $('#preference-cancel'),
			display: $('#preference-display'),
			form: $('#preference-form')
		},
		'company-detail':{
			btn: $('#company-detail'),
			cancelBtn: $('#company-detail-cancel'),
			display: $('#company-detail-display'),
			form: $('#company-detail-form')
		},
		'company-social':{
			btn: $('#company-social'),
			cancelBtn: $('#company-social-cancel'),
			display: $('#company-social-display'),
			form: $('#company-social-form')
		},
		'work' :{
			btn: $('#work'),
			cancelBtn: $('#work-cancel'),
			display: $('#work-display'),
			form: $('#work-form')
		}
	}

	_.each(edit, function(item){
		item.btn.click(function(){
			item.display.addClass('hide')
			item.form.removeClass('hide')
			if(item.cancelBtn){
				item.btn.addClass('hide')
			}
		})

		if(item.cancelBtn){
			item.cancelBtn.click(function(){
				item.display.removeClass('hide')
				item.form.addClass('hide')
				item.btn.removeClass('hide')
			})
		}
	})

	$('#company-social-add').click(function(){
		edit['company-social'].btn.trigger('click')
	})

	$('#work-add').click(function(){
		edit['work'].btn.trigger('click')
	})

	{% if form_business_head_error %}
		edit.head.btn.trigger('click')
	{% endif %}

	{% if form_business_company_desc_error %}
		edit['company-desc'].btn.trigger('click')
	{% endif %}

	{% if form_business_service_desc_error %}
		edit['service-desc'].btn.trigger('click')
	{% endif %}

	{% if form_business_preference_error %}
		edit['preference'].btn.trigger('click')
	{% endif %}

	{% if form_business_company_detail_error %}
		edit['company-detail'].btn.trigger('click')
	{% endif %}

	{% if form_business_company_social_error %}
		edit['company-social'].btn.trigger('click')
	{% endif %}

	{% if form_business_work_error %}
		edit['work'].btn.trigger('click')
	{% endif %}

	$('#id_business_since').datepicker({ dateFormat: 'yy-mm-dd' })

	//travel distance
	var travelDistanceBlock = $('#form-group-id_travel_distance_0')
	var travelToCustomerSelect = $('#id_travel_to_customer')
	var travelDistanceInputs = $('#id_travel_distance input');

	travelToCustomerSelect.change(function(){
		if(travelToCustomerSelect.val() === 'some_areas'){
			travelDistanceBlock.removeClass('hide')

			var allEmpty = true;
			_.each(travelDistanceInputs, function(input){ 
				allEmpty = allEmpty && !input.checked
			})

			//only check all by default if all unchecked
			if(allEmpty){
				travelDistanceInputs.prop('checked', true)
			}

		} else {
			travelDistanceBlock.addClass('hide')
			travelDistanceInputs.prop('checked', false)
		}
	})

	$(function(){
		travelToCustomerSelect.trigger('change')
	})
</script>

{% endwith %}
{% endblock %}